# 智能城市电池管理系统

## 项目简介
本项目是一个基于Spring Boot和MQTT的智能城市电池管理系统，
主要用于监控和管理电动车辆的电池状态，包括电池温度、电量等数据的采集，
以及异常状态的实时监控和告警。系统采用MQTT协议实现设备与服务器之间的实时通信，
确保数据的及时性和可靠性。

```

## MQTT主题说明

### 发布主题（Pub）
1. `pubCarVID`
   - 用途：接收车辆历史数据查询请求
   - 请求格式：
   ```json
   {
       "PID": "battery001"
   }
   ```
   - 响应：返回指定电池的历史温度和电量数据
   - 响应格式：
   ```json
   [
       {
           "T": 25.5,
           "C": 80.0
       }
   ]
   ```

2. `pubTip`
   - 用途：接收异常信息查询请求
   - 请求格式：
   ```json
   {
       "search": 1
   }
   ```
   - 响应：返回所有电池的异常状态历史记录
   - 响应格式：
   ```json
   [
       {
           "PID": "battery001",
           "time": "09:54:55",
           "status": "电池温度异常"
       }
   ]
   ```

### 订阅主题（Sub）
1. `subCarData`
   - 用途：接收电池实时数据
   - 数据格式：
   ```json
   {
       "VID": "vehicle001",
       "PID": "battery001",
       "T": 25.5,
       "C": 80.0
   }
   ```
   - 说明：
      - 系统会检查数据是否变化，只有新数据才会保存
      - 温度(T)和电量(C)只要有一个变化就会记录
      - 支持实时监控电池状态

2. `subTip`
   - 用途：接收电池异常状态告警
   - 数据格式：
   ```json
   {
       "PID": "battery001",
       "time": "10:15:30",
       "status": 1
   }
   ```
   - 状态码说明：
      - 1: 电池温度异常
      - 2: 电池电量过低
      - 3: 不能到达最近换电站
   - 说明：系统会记录异常发生的时间，便于后续分析

3. `subAllMsg`
   - 用途：发送车辆历史数据响应
   - 响应格式：
   ```json
   [
       {
           "T": 25.5,
           "C": 80.0
       }
   ]
   ```
   - 说明：仅返回温度和电量数据，用于前端图表展示

4. `subHistoryTip`
   - 用途：发送异常历史数据响应
   - 响应格式：
   ```json
   [
       {
           "PID": "battery001",
           "time": "09:54:55",
           "status": "电池温度异常"
       }
   ]
   ```
   - 说明：返回所有异常记录，包含状态文字描述

## 主要功能
1. 电池数据采集
   - 实时接收电池温度和电量数据
   - 数据去重，避免重复存储
   - 支持多车辆多电池管理
   - 数据变化检测，只保存有效数据

2. 异常状态监控
   - 实时接收电池异常状态
   - 记录异常发生时间
   - 支持多种异常类型
   - 异常状态文字描述

3. 历史数据查询
   - 支持查询指定电池的历史数据
   - 支持查询所有异常记录
   - 数据格式转换，便于前端展示
   - 按时间排序，支持历史趋势分析